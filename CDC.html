<!DOCTYPE html>
<html>
<head>
    <title>เครื่องคำนวณยาเคมีบำบัด (Regimen Dose)</title>
    <meta charset="UTF-8">
    <style>
        /* สไตล์ CSS พื้นฐาน */
        body { font-family: Arial, sans-serif; background-color: #f4f4f9; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .calculator-container { 
            background-color: #ffffff; 
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); 
            width: 350px; 
            text-align: left; 
        }
        h1 { color: #333; border-bottom: 2px solid #5c67f2; padding-bottom: 10px; margin-bottom: 20px; text-align: center; }
        label, input, select { display: block; margin-top: 15px; width: 100%; box-sizing: border-box; }
        input[type="number"], select { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        .result-box { margin-top: 25px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background-color: #eaf0ff; }
        .result-label { font-weight: bold; color: #5c67f2; margin-bottom: 5px; }

        /* สไตล์สำหรับตารางผลลัพธ์ */
        #resultMultiDose table { width:100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9em; }
        #resultMultiDose th, #resultMultiDose td { padding: 8px; border: 1px solid #ccc; text-align: center; }
        #resultMultiDose th { background-color: #ddd; }

        /* สไตล์ปุ่มคำนวณ */
        .calculate-button { 
            margin-top: 25px; padding: 15px 25px; background-color: #5c67f2; color: white; border: none; 
            border-radius: 6px; width: 100%; cursor: pointer; font-size: 18px; font-weight: bold; 
            transition: background-color 0.3s ease; 
        }
        .calculate-button:hover { background-color: #4a54e0; }
    </style>
</head>
<body>

    <div class="calculator-container">
        <h1>เครื่องคำนวณยาเคมีบำบัด</h1>
        
        <label for="height">ส่วนสูง (cm):</label>
        <input type="number" id="height" value="170" min="1" oninput="calculateChemoDose()"> 
        
        <label for="weight">น้ำหนัก (kg):</label>
        <input type="number" id="weight" value="70" min="1" oninput="calculateChemoDose()">
        
        <div class="result-box" style="margin-bottom: 20px; background-color: #ffeaea;">
            <div class="result-label" style="color: #d9534f;">พื้นที่ผิวร่างกาย (BSA):</div>
            <span id="resultBSA">0.00 m²</span>
        </div>

        <hr style="margin: 20px 0;">
        
        <label for="drugProtocol">เลือกสูตรยา (Regimen):</label>
        <select id="drugProtocol" onchange="calculateChemoDose()">
            <option value="">-- กรุณาเลือกสูตรยา --</option>
            <option value="mFOLFOX-6">mFOLFOX-6</option>
            <option value="mFOLFIRI">mFOLFIRI</option>
            <option value="ABVD">ABVD Regimen</option>
            <option value="FOLFOX">FOLFOX (ตัวอย่างเดิม)</option>
        </select>
        
        <button onclick="calculateChemoDose()" class="calculate-button">
            คำนวณขนาดยา
        </button>

        <div class="result-box">
            <div class="result-label">สรุปขนาดยาที่ต้องให้ (Total Dose):</div>
            <div id="resultMultiDose">
                โปรดเลือกสูตรยาและกรอกข้อมูลผู้ป่วย
            </div>
        </div>
    </div>

    <script>
        // *** ฐานข้อมูลสูตรยา (CHEMO_REGIMENS) ***
const CHEMO_REGIMENS = {
    // สูตรยา mFOLFOX-6 (สำหรับ Colorectal Cancer)
    'mFOLFOX-6': [
        // Oxaliplatin: 85 mg/m2 (Cycle 1)
        { name: 'Oxaliplatin', dose_m2: 85, max_dose: null, note: 'mg/m²' },
        // Leucovorin (LV): 200 mg/m2 (Cycle 1)
        { name: 'Leucovorin', dose_m2: 200, max_dose: null, note: 'mg/m²' },
        // 5-Fluorouracil (5-FU) Bolus: 400 mg/m2 (Cycle 1)
        { name: '5-FU Bolus', dose_m2: 400, max_dose: null, note: 'mg/m²' },
        // 5-Fluorouracil (5-FU) Infusion: 1200 mg/m2 (46-hr infusion)
        { name: '5-FU Infusion', dose_m2: 1200, max_dose: null, note: 'mg/m²' }
    ],
    // สูตรยา mFOLFIRI (สำหรับ Colorectal Cancer)
    'mFOLFIRI': [
        // Irinotecan: 180 mg/m2
        { name: 'Irinotecan', dose_m2: 180, max_dose: null, note: 'mg/m²' },
        // Leucovorin (LV): 200 mg/m2
        { name: 'Leucovorin', dose_m2: 200, max_dose: null, note: 'mg/m²' },
        // 5-Fluorouracil (5-FU) Bolus: 400 mg/m2
        { name: '5-FU Bolus', dose_m2: 400, max_dose: null, note: 'mg/m²' },
        // 5-Fluorouracil (5-FU) Infusion: 1200 mg/m2 (46-hr infusion)
        { name: '5-FU Infusion', dose_m2: 1200, max_dose: null, note: 'mg/m²' }
    ],
    // สูตรยาอื่นๆ ที่เราใช้เป็นตัวอย่างก่อนหน้า
    'ABVD': [
        { name: 'Doxorubicin', dose_m2: 25, max_dose: 40, note: 'mg/m²' },
        { name: 'Bleomycin', dose_m2: 10, max_dose: null, note: 'mg/m²' }, 
        { name: 'Vinblastine', dose_m2: 6, max_dose: 15, note: 'mg/m²' },
        { name: 'Dacarbazine', dose_m2: 375, max_dose: null, note: 'mg/m²' }
    ],
};

// *** ฟังก์ชันคำนวณหลัก ทำงานเมื่อมีการเปลี่ยนแปลงข้อมูลหรือกดปุ่ม ***
function calculateChemoDose() {
    // 1. ดึงค่าตัวแปร
    let height = parseFloat(document.getElementById("height").value) || 0;
    let weight = parseFloat(document.getElementById("weight").value) || 0;
    let protocol = document.getElementById("drugProtocol").value;

    let resultBSA = document.getElementById("resultBSA");
    let resultMultiDose = document.getElementById("resultMultiDose");

    // 2. ตรวจสอบข้อมูลผู้ป่วย
    if (height <= 0 || weight <= 0) {
        resultBSA.innerHTML = "❌ ป้อนส่วนสูงและน้ำหนัก";
        resultMultiDose.innerHTML = "โปรดกรอกข้อมูลผู้ป่วย";
        return;
    }
    
    // 3. คำนวณ BSA (Mosteller Formula)
    let bsa = Math.sqrt((height * weight) / 3600); 
    resultBSA.innerHTML = `${bsa.toFixed(2)} m²`; 

    // 4. ตรวจสอบและดึงข้อมูลสูตรยา
    if (protocol === "") {
        resultMultiDose.innerHTML = "โปรดเลือกสูตรยาจากรายการ";
        return;
    }
    const selectedRegimen = CHEMO_REGIMENS[protocol];
    
    // 5. วนซ้ำเพื่อคำนวณยาแต่ละตัวและสร้างตารางผลลัพธ์
    let tableHTML = `
        <table style="width:100%; border-collapse: collapse; margin-top: 10px;">
            <tr style="background-color: #ddd;">
                <th style="padding: 8px; border: 1px solid #ccc; text-align: left;">ชื่อยา</th>
                <th style="padding: 8px; border: 1px solid #ccc;">Dose/m²</th>
                <th style="padding: 8px; border: 1px solid #ccc;">Total Dose (mg)</th>
                <th style="padding: 8px; border: 1px solid #ccc;">Note</th>
            </tr>
    `;

    selectedRegimen.forEach(drug => {
        let calculatedDose = bsa * drug.dose_m2;
        let finalDose = calculatedDose;
        let note = "✅ OK";

        // ตรวจสอบ Dose Capping
        if (drug.max_dose !== null && calculatedDose > drug.max_dose) {
            finalDose = drug.max_dose;
            note = `⚠️ Capped: Max ${drug.max_dose.toFixed(1)} mg`;
        }

        tableHTML += `
            <tr>
                <td style="padding: 8px; border: 1px solid #ccc; text-align: left;">${drug.name}</td>
                <td style="padding: 8px; border: 1px solid #ccc; text-align: center;">${drug.dose_m2} ${drug.note}</td>
                <td style="padding: 8px; border: 1px solid #ccc; font-weight: bold; text-align: center;">${finalDose.toFixed(1)}</td>
                <td style="padding: 8px; border: 1px solid #ccc; text-align: center; color: #f0ad4e;">${note}</td>
            </tr>
        `;
    });

    tableHTML += `</table>`;
    
    // 6. แสดงตารางผลลัพธ์
    resultMultiDose.innerHTML = tableHTML;
}

// เรียกใช้ฟังก์ชันคำนวณทันทีเมื่อโหลดหน้าเว็บ
document.addEventListener('DOMContentLoaded', calculateChemoDose);
    </script>

</body>
</html>
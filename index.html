<!DOCTYPE html>
<html>
<head>
    <title>เครื่องคำนวณยาเคมีบำบัด (Regimen Dose)</title>
    <meta charset="UTF-8">
    <style>

        /* สไตล์ CSS พื้นฐาน */
        body { font-family: Arial, sans-serif; background-color: #f4f4f9; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .calculator-container { 
            background-color: #ffffff; 
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); 
            width: 350px; 
            text-align: left; 
        }
        h1 { color: #333; border-bottom: 2px solid #5c67f2; padding-bottom: 10px; margin-bottom: 20px; text-align: center; }
        label, input, select { display: block; margin-top: 15px; width: 100%; box-sizing: border-box; }
        input[type="number"], select { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        .result-box { margin-top: 25px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background-color: #eaf0ff; }
        .result-label { font-weight: bold; color: #5c67f2; margin-bottom: 5px; }

        /* สไตล์สำหรับตารางผลลัพธ์ */
        #resultMultiDose table { width:100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9em; }
        #resultMultiDose th, #resultMultiDose td { padding: 8px; border: 1px solid #ccc; text-align: center; }
        #resultMultiDose th { background-color: #ddd; }

        /* สไตล์ปุ่มคำนวณ */
        .calculate-button { 
            margin-top: 25px; padding: 15px 25px; background-color: #5c67f2; color: white; border: none; 
            border-radius: 6px; width: 100%; cursor: pointer; font-size: 18px; font-weight: bold; 
            transition: background-color 0.3s ease; 
        }
        .calculate-button:hover { background-color: #4a54e0; }

      /* *** สไตล์สำหรับเครดิต (witsao-oya) *** */
        #credit {
            /* โค้ดเดิม: ตรึงไว้ด้านล่างจอ */
            position: fixed; 
            bottom: 5px;
            width: 100%; /* ให้กว้างเต็มจอ */
            z-index: 10; 
            
            /* *** ส่วนที่แก้ไข/เพิ่ม: ใช้ Flexbox จัดกึ่งกลาง *** */
            display: flex; /* เปิดใช้งาน Flexbox */
            justify-content: center; /* จัดเนื้อหาให้อยู่กึ่งกลางแนวนอน */
            align-items: center; /* จัดเนื้อหาให้อยู่กึ่งกลางแนวตั้ง (ถ้ามี) */
            /* *************************************************** */
            
            background-color: #f4f4f9; /* ใส่พื้นหลังให้ตรงกับ Body */
            font-size: 11px;
            color: #ccc;
            opacity: 0.9;
        }
        
        /* Responsive Design */
        @media (max-width: 600px) {
            .calculator-container { width: 90%; padding: 20px; margin: 15px; }
        }
        @media (min-width: 601px) {
            .calculator-container { max-width: 450px; width: 100%; }
        }
    </style>
</head>
<body>
<div class="calculator-container">
        <div style="text-align: center; margin-bottom: 20px;">
            <img src="hospital_logo.png" alt="กลุ่มการกิจด้านการพยาบาล โรงพยาบาลธัญญารักษ์" style="max-width: 150px; height: auto;">
        </div>
    <div class="calculator-container">
        <h1>เครื่องคำนวณยาเคมีบำบัด</h1>
        
        <label for="height">ส่วนสูง (cm):</label>
        <input type="number" id="height" value="170" min="1" oninput="calculateChemoDose()"> 
        
        <label for="weight">น้ำหนัก (kg):</label>
        <input type="number" id="weight" value="70" min="1" oninput="calculateChemoDose()">
        
        <div class="result-box" style="margin-bottom: 20px; background-color: #ffeaea;">
            <div class="result-label" style="color: #d9534f;">พื้นที่ผิวร่างกาย (BSA):</div>
            <span id="resultBSA">0.00 m²</span>
        </div>

        <hr style="margin: 20px 0;">
        
        <label for="drugProtocol">เลือกสูตรยา (Regimen):</label>
        <select id="drugProtocol" onchange="calculateChemoDose()">
            <option value="">-- กรุณาเลือกสูตรยา --</option>
            <option value="mFOLFOX-6">mFOLFOX-6</option>
            <option value="mFOLFIRI">mFOLFIRI</option>
            <option value="ABVD">ABVD Regimen</option>
        </select>
        
        <label for="doseReduction">ปรับลดขนาดยา (Dose Reduction):</label>
        <select id="doseReduction" onchange="calculateChemoDose()">
            <option value="1">ไม่ลดโดส (0%)</option>
            <option value="0.95">ลดโดส 5%</option>
            <option value="0.90">ลดโดส 10%</option>
            <option value="0.85">ลดโดส 15%</option>
            <option value="0.80">ลดโดส 20%</option>
            <option value="0.75">ลดโดส 25%</option>
            <option value="0.70">ลดโดส 30%</option>
        </select>
        
        <button onclick="calculateChemoDose()" class="calculate-button">
            คำนวณขนาดยา
        </button>

        <div class="result-box">
            <div class="result-label">สรุปขนาดยาที่ต้องให้ (Total Dose):</div>
            <div id="resultMultiDose">
                โปรดเลือกสูตรยาและกรอกข้อมูลผู้ป่วย
            </div>
        </div>
    </div> <script>
        // *** โค้ด JavaScript ทั้งหมดที่รวมฐานข้อมูลและฟังก์ชันคำนวณ ***
        const CHEMO_REGIMENS = {
            'mFOLFOX-6': [
                { name: 'Oxaliplatin', dose_m2: 85, max_dose: null, note: 'mg/m²' },
                { name: 'Leucovorin', dose_m2: 200, max_dose: null, note: 'mg/m²' },
                { name: '5-FU Bolus', dose_m2: 400, max_dose: null, note: 'mg/m²' },
                { name: '5-FU Infusion', dose_m2: 1200, max_dose: null, note: 'mg/m²' }
            ],
            'mFOLFIRI': [
                { name: 'Irinotecan', dose_m2: 180, max_dose: null, note: 'mg/m²' },
                { name: 'Leucovorin', dose_m2: 200, max_dose: null, note: 'mg/m²' },
                { name: '5-FU Bolus', dose_m2: 400, max_dose: null, note: 'mg/m²' },
                { name: '5-FU Infusion', dose_m2: 1200, max_dose: null, note: 'mg/m²' }
            ],
            'ABVD': [
                { name: 'Doxorubicin', dose_m2: 25, max_dose: 40, note: 'mg/m²' },
                { name: 'Bleomycin', dose_m2: 10, max_dose: null, note: 'mg/m²' }, 
                { name: 'Vinblastine', dose_m2: 6, max_dose: 15, note: 'mg/m²' },
                { name: 'Dacarbazine', dose_m2: 375, max_dose: null, note: 'mg/m²' }
            ],
        };

        function calculateChemoDose() {
            let height = parseFloat(document.getElementById("height").value) || 0;
            let weight = parseFloat(document.getElementById("weight").value) || 0;
            let protocol = document.getElementById("drugProtocol").value;
            let reductionFactor = parseFloat(document.getElementById("doseReduction").value) || 1; 

            let resultBSA = document.getElementById("resultBSA");
            let resultMultiDose = document.getElementById("resultMultiDose");

            if (height <= 0 || weight <= 0) {
                resultBSA.innerHTML = "❌ ป้อนส่วนสูงและน้ำหนัก";
                resultMultiDose.innerHTML = "โปรดกรอกข้อมูลผู้ป่วย";
                return;
            }
            
            let bsa = Math.sqrt((height * weight) / 3600); 
            resultBSA.innerHTML = `${bsa.toFixed(2)} m²`; 

            if (protocol === "") {
                resultMultiDose.innerHTML = "โปรดเลือกสูตรยาจากรายการ";
                return;
            }
            const selectedRegimen = CHEMO_REGIMENS[protocol];
            
            let tableHTML = `
                <table style="width:100%; border-collapse: collapse; margin-top: 10px;">
                    <tr style="background-color: #ddd;">
                        <th style="padding: 8px; border: 1px solid #ccc; text-align: left;">ชื่อยา</th>
                        <th style="padding: 8px; border: 1px solid #ccc;">Dose/m²</th>
                        <th style="padding: 8px; border: 1px solid #ccc;">Total Dose (mg)</th>
                        <th style="padding: 8px; border: 1px solid #ccc;">Note</th>
                    </tr>
            `;

            selectedRegimen.forEach(drug => {
                let calculatedDose = bsa * drug.dose_m2;
                let adjustedDose = calculatedDose * reductionFactor;
                let finalDose = adjustedDose;
                let note = "✅ OK";

                if (drug.max_dose !== null && adjustedDose > drug.max_dose) {
                    finalDose = drug.max_dose;
                    note = `⚠️ Capped: Max ${drug.max_dose.toFixed(1)} mg`;
                }

                if (reductionFactor < 1) {
                    let percentReduced = (1 - reductionFactor) * 100;
                    let reductionNote = `⬇️ Reduced ${percentReduced.toFixed(0)}%`;
                    
                    if (finalDose !== adjustedDose) { 
                         note = reductionNote + " & Capped!";
                    } else {
                         note = reductionNote;
                    }
                }

                tableHTML += `
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ccc; text-align: left;">${drug.name}</td>
                        <td style="padding: 8px; border: 1px solid #ccc; text-align: center;">${drug.dose_m2} ${drug.note}</td>
                        <td style="padding: 8px; border: 1px solid #ccc; font-weight: bold; text-align: center;">${finalDose.toFixed(1)}</td>
                        <td style="padding: 8px; border: 1px solid #ccc; text-align: center; color: #f0ad4e;">${note}</td>
                    </tr>
                `;
            });

            tableHTML += `</table>`;
            resultMultiDose.innerHTML = tableHTML;
        }

        document.addEventListener('DOMContentLoaded', calculateChemoDose);
// ฟังก์ชันสำหรับนับและแสดงผลจำนวนผู้เข้าชม
function getVisitorCount() {
    // ต้องแทนที่ 'your_github_repo_name' ด้วย URL Repository จริงของคุณ
    const key = 'witsaoo-jpg/cdc'; 
    const countUrl = `https://api.countapi.xyz/hit/${key}/visits`;

    fetch(countUrl) // ดึงข้อมูลจาก CountAPI
        .then(response => response.json())
        .then(data => {
            const countElement = document.getElementById('visitorCount');
            if (countElement) {
                countElement.innerHTML = `| Visitors: ${data.value}`;
            }
        })
        .catch(error => {
            console.error('Error fetching visitor count:', error);
            const countElement = document.getElementById('visitorCount');
            if (countElement) {
                countElement.innerHTML = '| Visitors: N/A';
            }
        });
}

// **เรียกใช้ฟังก์ชันนี้ตอนโหลดหน้าเว็บ**
document.addEventListener('DOMContentLoaded', getVisitorCount);       
    </script>
<div id="credit">
        Developed by witsao-oya Version 1.00
<div id="sfc28nygdsbhskmdubgp7jqqqc8j8whjsmz"></div><script type="text/javascript" src="https://counter1.optistats.ovh/private/counter.js?c=28nygdsbhskmdubgp7jqqqc8j8whjsmz&down=async" async></script><noscript><a href="https://www.freecounterstat.com" title="free traffic counter"><img src="https://counter1.optistats.ovh/private/freecounterstat.php?c=28nygdsbhskmdubgp7jqqqc8j8whjsmz" border="0" title="free traffic counter" alt="free traffic counter"></a></noscript>

</div>
    
    </body>
</html>

<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เครื่องคำนวณยาเคมีบำบัด (Regimen Dose)</title>
    <style>
        :root {
            --primary: #4a6cf7;
            --primary-dark: #2f4ed8;
            --bg: #f5f7ff;
            --card-bg: #ffffff;
            --border: #d9e1ff;
            --text-dark: #2e2e3a;
        }

        body {
            font-family: "Prompt", sans-serif;
            background: var(--bg);
            margin: 0;
            padding: 15px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            flex-direction: column;
        }

        .calculator-container {
            background: var(--card-bg);
            width: 420px;
            max-width: 95%;
            padding: 35px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            margin: auto;
        }

        h1 {
            text-align: center;
            color: var(--primary);
            margin-bottom: 25px;
            font-size: 1.8rem;
        }

        label {
            margin-top: 15px;
            font-weight: 600;
            color: var(--text-dark);
            display: block;
        }

        input, select {
            margin-top: 8px;
            padding: 12px;
            width: 100%;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 5px rgba(74, 108, 247, 0.3);
        }

        .calculate-button {
            margin-top: 25px;
            padding: 15px;
            width: 100%;
            font-size: 1.2rem;
            border: none;
            border-radius: 12px;
            background: var(--primary);
            color: white;
            cursor: pointer;
            font-weight: bold;
        }

        .calculate-button:hover {
            background: var(--primary-dark);
        }

        .result-box {
            margin-top: 25px;
            padding: 15px;
            background: #eef3ff;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .result-label {
            font-weight: 700;
            color: var(--primary-dark);
        }

        #resultMultiDose table {
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
            font-size: 0.95rem;
        }

        #resultMultiDose th {
            background: var(--primary);
            color: white;
            padding: 10px;
        }

        #resultMultiDose td {
            border-bottom: 1px solid #e5e7ff;
            padding: 8px;
            text-align: center;
        }

        #credit {
            text-align: center;
            font-size: 11px;
            color: #bfc4d9;
            margin-top: 20px;
            padding-bottom: 10px;
        }

        @media (max-width: 480px) {
            .calculator-container { width: 90%; padding: 25px; }
        }
    </style>
</head>
<body>

<div class="calculator-container">
    <h1>เครื่องคำนวณยาเคมีบำบัด</h1>

    <label>ส่วนสูง (cm)</label>
    <input type="number" id="height" value="170" min="1" oninput="calculateChemoDose()" />

    <label>น้ำหนัก (kg)</label>
    <input type="number" id="weight" value="70" min="1" oninput="calculateChemoDose()" />

    <div class="result-box" style="background:#ffecec; margin-top:20px;">
        <div class="result-label" style="color:#d9534f;">พื้นที่ผิวร่างกาย (BSA):</div>
        <span id="resultBSA">0.00 m²</span>
    </div>

    <label style="margin-top:25px;">เลือกสูตรยา (Regimen)</label>
    <select id="drugProtocol" onchange="calculateChemoDose()">
        <option value="">-- กรุณาเลือกสูตรยา --</option>
        <option value="mFOLFOX-6">mFOLFOX-6</option>
        <option value="mFOLFIRI">mFOLFIRI</option>
        <option value="ABVD">ABVD Regimen</option>
    </select>

    <label style="margin-top:25px;">ปรับลดขนาดยา (Dose Reduction)</label>
    <select id="doseReduction" onchange="calculateChemoDose()">
        <option value="1">ไม่ลดโดส (0%)</option>
        <option value="0.95">ลดโดส 5%</option>
        <option value="0.90">ลดโดส 10%</option>
        <option value="0.85">ลดโดส 15%</option>
        <option value="0.80">ลดโดส 20%</option>
        <option value="0.75">ลดโดส 25%</option>
        <option value="0.70">ลดโดส 30%</option>
    </select>

    <button class="calculate-button" onclick="calculateChemoDose()">คำนวณขนาดยา</button>

    <div class="result-box">
        <div class="result-label">สรุปขนาดยาที่ต้องให้ (Total Dose)</div>
        <div id="resultMultiDose">โปรดเลือกสูตรยาและกรอกข้อมูลผู้ป่วย</div>
    </div>
</div>

<div id="credit">
    Developed by witsao-oya — Responsive Version 1.1
</div>

<script>
const CHEMO_REGIMENS = {
    'mFOLFOX-6': [
        { name: 'Oxaliplatin', dose_m2: 85 },
        { name: 'Leucovorin', dose_m2: 200 },
        { name: '5-FU Bolus', dose_m2: 400 },
        { name: '5-FU Infusion', dose_m2: 1200 }
    ],
    'mFOLFIRI': [
        { name: 'Irinotecan', dose_m2: 180 },
        { name: 'Leucovorin', dose_m2: 200 },
        { name: '5-FU Bolus', dose_m2: 400 },
        { name: '5-FU Infusion', dose_m2: 1200 }
    ],
    'ABVD': [
        { name: 'Doxorubicin', dose_m2: 25, max_dose: 40 },
        { name: 'Bleomycin', dose_m2: 10 },
        { name: 'Vinblastine', dose_m2: 6, max_dose: 15 },
        { name: 'Dacarbazine', dose_m2: 375 }
    ]
};

function calculateBSA(h, w) {
    return Math.sqrt((h * w) / 3600);
}

function calculateChemoDose() {
    let h = parseFloat(document.getElementById("height").value) || 0;
    let w = parseFloat(document.getElementById("weight").value) || 0;
    let protocol = document.getElementById("drugProtocol").value;
    let reduction = parseFloat(document.getElementById("doseReduction").value);

    if (!h || !w) return;

    let bsa = calculateBSA(h, w);
    document.getElementById("resultBSA").innerText = bsa.toFixed(2) + " m²";

    if (!protocol) {
        document.getElementById("resultMultiDose").innerHTML = "โปรดเลือกสูตรยา";
        return;
    }

    let reducPercent = ((1 - reduction) * 100).toFixed(0) + "%";

    let drugs = CHEMO_REGIMENS[protocol];
    let html = `<table>
        <tr>
            <th>ยา</th>
            <th>ขนาด (mg/m²)</th>
            <th>ต้องให้ (mg)</th>
            <th>reduc (%)</th>
        </tr>`;

    drugs.forEach(drug => {
        let dose = drug.dose_m2 * bsa * reduction;
        if (drug.max_dose && dose > drug.max_dose) dose = drug.max_dose;
        html += `<tr>
            <td>${drug.name}</td>
            <td>${drug.dose_m2}</td>
            <td>${dose.toFixed(1)}</td>
            <td>${reducPercent}</td>
        </tr>`;
    });

    html += "</table>";
    document.getElementById("resultMultiDose").innerHTML = html;
}
    // Visitor counter using localStorage increments per browser
function updateVisitorCount() {
    let count = localStorage.getItem('visitorCount');
    if (count === null) {
        count = 0;
    } else {
        count = parseInt(count);
    }
    count++;
    localStorage.setItem('visitorCount', count);
    document.getElementById("visitorCount").innerText = count;
}

// Call visitor count update on page load
window.onload = function() {
    updateVisitorCount();
    calculateChemoDose(); // your existing function call
}
</script>
<div style="text-align:center; margin-top: 20px;">
    จำนวนผู้เข้าชมหน้าเว็บนี้: <span id="visitorCount">0</span> ครั้ง
</div>
</body>
</html>
